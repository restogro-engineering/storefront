<div class="shipping-container">
    <div class="steps-container" *ngIf="!(signedIn$ | async)">
        <div
            class="step"
            [class.active]="step === 'customerDetails'"
            (click)="(step == 'customerDetails')"
        >
            CUSTOMER DETAILS
        </div>
        <div class="border-left ml-1 section-container border-left ml-1 pb-4">
            <div *ngIf="step === 'customerDetails'" class="pt-4">
                <form #customerForm="ngForm" class="customer-details-form pl-4">
                    <div class="d-row pb-2">
                        <input
                            class="form-control"
                            placeholder="First Name"
                            name="firstName"
                            [(ngModel)]="firstName"
                            required
                        />
                        <input
                            class="form-control"
                            placeholder="Last Name"
                            name="lastName"
                            [(ngModel)]="lastName"
                            required
                        />
                    </div>
                    <div class="d-row pb-2">
                        <input
                            class="form-control"
                            placeholder="Email Address"
                            name="emailAddress"
                            [(ngModel)]="emailAddress"
                            required
                        />
                        <input
                            type="date"
                            class="form-control"
                            placeholder="Date of birth"
                            name="emailAddress"
                            [(ngModel)]="dateofbirth"
                            (onfocus)="this.type = 'date'"
                            (onblur)="this.type = 'text'"
                            required
                        />
                    </div>
                    <div class="d-row pb-2">
                        <input
                            class="form-control"
                            placeholder="Company name"
                            name="companyName"
                            [(ngModel)]="companyName"
                        />
                        <input
                            class="form-control"
                            placeholder="Profession"
                            name="profession"
                            [(ngModel)]="profession"
                        />
                    </div>
                    <div class="btns-container">
                        <button
                            class="btn btn-primary mt-3"
                            [disabled]="customerForm.invalid"
                            (click)="setCustomerDetails()"
                        >
                            Next
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div
            class="step"
            [class.active]="step === 'editAddress'"
            (click)="step = 'editAddress'"
        >
            DELIVERY ADDRESS
        </div>
        <div class="section-container border-left ml-1 pb-4">
            <div class="ml-4 pt-4" [hidden]="step !== 'editAddress'">
                <vsf-address-form
                    #addressForm
                    [address]="shippingAddress$ | async"
                    [availableCountries]="availableCountries$ | async"
                ></vsf-address-form>
                <div class="d-flex justify-content-end mt-3">
                    <button
                        class="btn btn-primary"
                        [disabled]="addressForm.addressForm.invalid"
                        (click)="deliverHere(addressForm.addressForm.value)"
                    >
                        Send to this address
                    </button>
                </div>
            </div>
        </div>

        <div
            class="step"
            [class.active]="step === 'editBillingAddress'"
            (click)="step = 'editBillingAddress'"
        >
            BILLING ADDRESS
        </div>
        <div class="section-container border-left ml-1 pt-4">
            <div class="ml-4" *ngIf="step === 'editBillingAddress'">
                <div>
                    <label>
                        <input
                            type="checkbox"
                            [checked]="sameAsDelivery"
                            (change)="onCheckBoxChange()"
                        />
                        <span class="pl-2">Same as delivery address</span>
                    </label>
                </div>
                <div>
                    <vsf-address-form
                        #billingAddressForm
                        [address]="billingAddress$ | async"
                        [availableCountries]="availableCountries$ | async"
                        [hidden]="sameAsDelivery"
                    ></vsf-address-form>
                    <vsf-address-form
                        #billingAddressForm2
                        [address]="shippingAddress$ | async"
                        [availableCountries]="availableCountries$ | async"
                        [hidden]="!sameAsDelivery"
                    ></vsf-address-form>
                    <div class="d-flex justify-content-end pb-4">
                        <button
                            [hidden]="sameAsDelivery"
                            class="btn btn-primary mt-3"
                            [disabled]="billingAddressForm.addressForm.invalid"
                            (click)="
                                billingHere(
                                    billingAddressForm.addressForm.value
                                )
                            "
                        >
                            Billing address
                        </button>
                        <button
                            [hidden]="!sameAsDelivery"
                            class="btn btn-primary mt-3"
                            [disabled]="billingAddressForm2.addressForm.invalid"
                            (click)="
                                billingHere(
                                    billingAddressForm2.addressForm.value
                                )
                            "
                        >
                            Billing address
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <div
            class="step"
            [class.active]="step === 'selectMethod'"
            (click)="step = 'selectMethod'"
        >
            Shipping Method
        </div>
        <div
            class="section-container border-left ml-1 pt-4"
            *ngIf="step === 'selectMethod'"
        >
            <div class="ml-4" *ngIf="step === 'selectMethod'">
                <div
                    class="form-check"
                    *ngFor="let method of eligibleShippingMethods$ | async"
                >
                    <input
                        class="form-check-input"
                        type="radio"
                        [(ngModel)]="shippingMethodId"
                        [value]="method.id"
                        [id]="method.id"
                    />
                    <label
                        class="form-check-label shipping-method"
                        [for]="method.id"
                    >
                        <div class="description">{{ method.name }}</div>
                        <div class="price">
                            {{ method.priceWithTax | formatPrice }}
                        </div>
                    </label>
                </div>
                <button
                    class="btn btn-primary mt-3"
                    [disabled]="!shippingMethodId"
                    (click)="proceedToPayment()"
                >
                    Proceed to payment
                </button>
            </div>
        </div>
    </div>

    <div class="steps-container" *ngIf="signedIn$ | async">
        <div
            class="step"
            [class.active]="step === 'selectAddress'"
            (click)="step = 'selectAddress'"
        >
            DELIVERY ADDRESS
        </div>
        <div class="section-container border-left ml-1 pb-4" >
            <div class="ml-4 pt-4" *ngIf="step === 'selectAddress'">
                <div
                    class="customer-address"
                    *ngFor="let address of customerAddresses$ | async"
                    (click)="setShippingAddress(address)"
                >
                    <div>
                        <input
                            class="form-check-input"
                            type="radio"
                            [checked]="
                                address.id === selectedDeliveryAddress?.id
                            "
                        />
                    </div>
                    <div>
                        <div
                            class="address-line"
                            *ngFor="let line of getLines(address)"
                        >
                            {{ line }}
                        </div>
                    </div>

                    <button
                        [hidden]="address.id !== selectedDeliveryAddress?.id"
                        class="btn btn-primary mt-2"
                        (click)="deliverHere(address)"
                    >
                        Deliver here
                    </button>
                </div>
                <div class="d-flex align-items-end justify-content-end">
                    <button class="btn btn-primary" (click)="createAddress()">
                        Add new address
                    </button>
                </div>
            </div>
        </div>

        <div
            class="step"
            [class.active]="step === 'selectBillingAddress'"
            (click)="step = 'selectBillingAddress'"
        >
            BILLING ADDRESS
        </div>
        <div class="section-container border-left ml-1 pb-4" >
            <div class="ml-4  pt-4"  *ngIf="step === 'selectBillingAddress'">
                <div>
                    <label>
                        <input
                            type="checkbox"
                            [checked]="sameAsDelivery"
                            (change)="onCheckBoxChange()"
                        />
                        <span class="pl-2">Same as delivery address</span>
                    </label>
                </div>
                <div>
                    <div
                        class="customer-address "
                        *ngFor="let address of customerAddresses$ | async"
                        (click)="setBillingAddress(address)"
                    >
                        <input
                            class="form-check-input"
                            type="radio"
                            [checked]="
                                address.id === selectedBillingAddress?.id
                            "
                        />
                        <div
                            class="address-line"
                            *ngFor="let line of getLines(address)"
                        >
                            {{ line }}
                        </div>

                        <button
                            [hidden]="address.id !== selectedBillingAddress?.id"
                            class="btn btn-primary mt-2"
                            (click)="billingHere(address)"
                        >
                            Send Bill here
                        </button>
                    </div>
                </div>

                <div class="d-flex align-items-end justify-content-end">
                    <button class="btn btn-primary" (click)="createAddress()">
                        Add new address
                    </button>
                </div>
            </div>
        </div>
        <div
            class="step"
            [class.active]="step === 'selectMethod'"
            (click)="step = 'selectMethod'"
        >
            SHIPPING METHOD
        </div>
        <div class="section-container border-left ml-1 pt-4" *ngIf="step === 'selectMethod'">
            <div class="ml-4">
                <div
                    class="form-check"
                    *ngFor="let method of eligibleShippingMethods$ | async"
                >
                    <input
                        class="form-check-input"
                        type="radio"
                        [(ngModel)]="shippingMethodId"
                        [value]="method.id"
                        [id]="method.id"
                    />
                    <label
                        class="form-check-label shipping-method"
                        [for]="method.id"
                    >
                        <div class="description">{{ method.name }}</div>
                        <div class="price">
                            {{ method.priceWithTax | formatPrice }}
                        </div>
                    </label>
                </div>
                <button
                    class="btn btn-primary mt-3"
                    [disabled]="!shippingMethodId"
                    (click)="proceedToPayment()"
                >
                    Proceed to payment
                </button>
            </div>
        </div>
    </div>
</div>
